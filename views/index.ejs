<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>村农</title>
<meta name="description" content="">
<meta name="keywords" content="">
<style>
	body{text-align:center;font-family:'KaiTi';}
	.content_box{width:100%;max-width:1000px;margin:auto;}
	header{text-align:left;}
	header h3{display:inline-block;}
	header p{margin-left:20px;display:inline-block;}
	a{text-decoration:none;color:#333;display:block;}
	a:hover{text-decoration:underline;color:#0d73b0;}
	ul{width:100%;max-width:1000px;margin:auto;padding-left:0px;display:inline-block;}
	li{list-style:none;padding:5px 0;text-align:left;}
	li p{margin:5px auto;}
	.page_list time{margin-left:10px;display:inline-block;vertical-align:middle;font-size:11px;}
	.chat_box{width:25%;margin-top:12px;display:inline-block;vertical-align:top;background:#FFF;border-radius:4px;display:none;}
	.message_box{width:100%;height:500px;box-shadow:0 0 5px #ccc;overflow-y:scroll;}
	.message_send{width:80%;height:30px;}
	.message_submit{width:15%;height:36px;}
</style>
</head>
<body>
	<div class="content_box">
		<header>
			<h3>村农</h3>
			<p>莫笑农家腊酒浑，丰年留客足鸡豚。</p>
		</header>
		<hr />
		<ul>
			<% for(var i in doc){ %>
				<li class="page_list">
					<a href="/page?id=<%= doc[i]._id %>">
						<p class="title">-  <%= doc[i].title %><time>2018</time></p>
						
	<!-- 				<p><%= doc[i].writer %></p>
						<p><%= doc[i].brief %></p> -->
					</a>
				</li>
			<% } %>
		</ul>
	</div>

	<div class="chat_box">
		<div class="message_box"></div>
		<input class="message_send" />
		<button class="message_submit">发送</button>
		<div style="padding:10px;">
			<h4 id="beauty">你的颜值：</h4>
			<input name="pic" type="file" id="imgFile" />
		</div>
	</div> 
</body>
<script src="/javascripts/jquery-1.12.0.min.js"></script>
<script src="/javascripts/socket.io.js"></script>
<script type="text/javascript">
	$('#imgFile').on('change',function(){
		var formData = new FormData();
		var file = $(this)[0].files[0];
		formData.append('pic',file);
		$.ajax({
			type:'POST',
			url:'/face/info',
			data:formData,
			processData:false,
			contentType:false,
			success:function(res){
				res = JSON.parse(res);
				console.log(res);
				$('#beauty').text("你的颜值："+res.data.face_list[0].beauty)
			}
		})
	})
	 //var socket = io.connect('http://localhost:3000');
	var socket = io();
	socket.on('getMsg',function(data){
		console.log(data);
		var msg_dom = $("<p>"+data.msg+"</p>")
		$('.message_box').append(msg_dom);
	})
	$('.message_submit').click(function(){
		socket.emit('sendData',{msg:$('.message_send').val()});
		$('.message_send').val('');
	});
	$(document).keyup(function(event){
		if(event.keyCode == 13){
			$('.message_submit').trigger("click");
		}
	})
</script>
</html>